<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>DOS Fn 4b00H: Execute a Program - TECH Help!</title><link rel="stylesheet" type="text/css" href="style.css"><meta http-equiv="X-UA-Compatible" content="IE=Edge"></head><body><h1>DOS Fn 4b00H: Execute a Program</h1><pre>                                                         Compatibility: <span class="c2">2.0+</span>
 Expects: <span class="c2">AX</span>    4b00H
          <span class="c2">DS:DX</span> address of an ASCIIZ<a href="913-qasciiz.html">▲</a> filespec of the program to execute
          <span class="c2">ES:BX</span> address of an <a href="355-exec_parameter_block__execparamrec_.html">ExecParamRec</a>
          ──────────────────────────────────────────────────────────────────
 Returns: <span class="c2">AX</span>    <a href="347-dos_error_codes.html">error code</a> if CF is set to CY
          else  All registers are destroyed, <span class="c2">including SS and SP</span>
          ──────────────────────────────────────────────────────────────────
    Info: Provides a means for a program (the parent) to execute another
          program (the child).  When the child exits, control will return
          to the parent.  It prepares a <a href="371-psp__program_segment_prefix.html">PSP</a> for the child, loads its code,
          performs any needed segment fixup, est the registers as expected,
          then begins executing the child program.

    <span class="c2">DS:DX</span> points to an ASCIIZ string in the form...
             <span class="c1">d</span>:\<span class="c1">path</span>\<span class="c1">filename.ext</span><span class="c2">◄0►</span>
          If the drive or path is omitted, defaults are assumed.

    <span class="c2">ES:BX</span> points to a block of memory prepared as an <a href="355-exec_parameter_block__execparamrec_.html">ExecParamRec</a> that has
          been filled with the information needed.

          Since the parent program initially receives all of available
          memory for its own processing, you must free some memory via
          Fn <a href="502-dos_fn_4ah__shrink_or_expand_a_memory_block.html">4aH</a> before performing using this fn.

          <span class="c2">To EXEC a program:</span>

          ■ Call Fn <a href="502-dos_fn_4ah__shrink_or_expand_a_memory_block.html">4aH</a> with ES=your <a href="371-psp__program_segment_prefix.html">PSP</a> and the minimum amount of memory
            that your program requires (in paragraphs).
          ■ Prepare an ASCIIZ<a href="913-qasciiz.html">▲</a> string of the program file to EXEC and set
            <span class="c2">DS:DX</span> to point to its first character.
          ■ Prepare an <a href="355-exec_parameter_block__execparamrec_.html">ExecParamRec</a> containing all required fields
          ■ Save the current values of SS, SP, DS, ES, and the <a href="351-dta__disk_transfer_address.html">DTA</a> in
            variables that are relative to CS (CS is the only point of
            reference after EXEC returns from the child).
          ■ Issue the EXEC call with AL=0
          ■ Restore SS and SP to local values
          ■ Check CF (the carry flag) to see if EXEC failed with an error
          ■ Restore DS, ES and the local <a href="351-dta__disk_transfer_address.html">DTA</a> if necessary
          ■ Check the <a href="920-qexitcode.html">exit code▲</a> via Fn <a href="509-dos_fn_4dh__get_program_exit_code.html">4dH</a> WAIT (if desired)

          All open files are duplicated, so the child can process data via
          <a href="362-file_handle.html">file handle</a> and/or use the <a href="828-standard_i_o_and_i_o_redirection.html">standard I/O</a> for input and output.
          Each handle's <a href="336-access_mode___open_mode.html">Access Mode</a> is duplicated, but any &quot;file locks&quot;
          that are in effect will not belong to the child.  See Fn <a href="529-dos_fn_5ch__lock_unlock_file_access.html">5cH</a>.

          Upon return from the child, the <a href="562-int_22h__terminate_address.html">INT 22H</a> (Terminate), <a href="563-int_23h__ctrl_break_exit_address.html">INT 23H</a>
          (Ctrl-Break), and <a href="564-int_24h__critical_error_handler.html">INT 24H</a> (Critical Error) vectors are restored
          to their previous values.

   Notes: ■ This function uses the loader portion of Command.Com which is
            transient in <span class="c2">DOS 2.0+</span> (a program may have overwritten it).
            Thus, this call could fail if DOS can't locate the Command.Com
            file.  You should make sure that COMSPEC= in the <a href="346-dos_environment.html">environment</a> is
            valid before the call.

          ■ Rather than parse the FCBs (as needed in the <a href="355-exec_parameter_block__execparamrec_.html">ExecParamRec</a>), you
            may find it convenient to load and execute a secondary copy of
            Command.Com, using the /C option.  For instance, to execute the
            FORMAT.COM program, set DS:DX to the address of an ASCIIZ
            string:

              &quot;c:\dos\command.com&quot;,0

            and set EPB+2 to the segment and offset of the command line:

              12H,&quot; /c format a: /s/4&quot;,0dH

            This secondary command interpreter uses a very small amount of
            memory (around 4K).  You can locate the drive and directory
            that contains COMMAND.COM by searching the <a href="346-dos_environment.html">DOS Environment</a> for
            the <a href="369-predefined_environment_variables.html">COMSPEC</a> string.

See Also: Fn <a href="505-dos_fn_4b01h__load_program.html">4b01H</a> (load program)
          Fn <a href="506-dos_fn_4b03h__load_overlay.html">4b03H</a> (load overlay)
          <a href="18-process_control_functions.html">Process Control Functions</a>
          <a href="829-program_startup___exit.html">Program Startup &amp; Exit</a>
          <a href="5-dos_function_index___quick_reference_subset.html">DOS Functions</a>
                                    <span class="c3">-♦-</span></pre></body></html>